<!-- src/app/chat/conversation/conversation.page.html -->
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" defaultHref="/chat"></ion-back-button>
    </ion-buttons>
    
    <div class="header-info" *ngIf="tutor">
      <ion-avatar class="header-avatar">
        <img [src]="tutor.profilePicture" [alt]="tutor.name">
      </ion-avatar>
      <div class="header-details">
        <ion-title class="tutor-name">{{ tutor.name }}</ion-title>
        <p class="tutor-subject">{{ tutor.subject }}</p>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="chat-content">
  <div class="messages-container" #messagesList>
    
    <!-- Message si pas de conversation -->
    <div *ngIf="messages.length === 0" class="empty-chat">
      <ion-icon name="person-outline" class="empty-icon"></ion-icon>
      <h3>Début de la conversation</h3>
      <p>Commencez à discuter avec {{ tutor?.name }}</p>
    </div>

    <!-- Messages -->
    <div *ngFor="let message of messages; let i = index" class="message-group">
      
      <!-- Séparateur de date -->
      <div *ngIf="shouldShowDateSeparator(i)" class="date-separator">
        <span>{{ formatDate(message.timestamp) }}</span>
      </div>

      <!-- Message -->
      <div class="message-wrapper" [class.own-message]="isOwnMessage(message)">
        <div class="message-bubble" [class.sent]="isOwnMessage(message)" [class.received]="!isOwnMessage(message)">
          <p class="message-text">{{ message.message }}</p>
          <span class="message-time">{{ formatTime(message.timestamp) }}</span>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<ion-footer class="chat-footer">
  <div class="message-input-container">
    <div class="input-wrapper">
      <ion-input
        [(ngModel)]="newMessage"
        placeholder="Tapez votre message..."
        type="text"
        class="message-input"
        (keypress)="onKeyPress($event)"
        maxlength="500">
      </ion-input>
      
      <ion-button 
        fill="clear" 
        size="large"
        color="primary"
        (click)="sendMessage()"
        [disabled]="!newMessage.trim()"
        class="send-button">
        <ion-icon name="send-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-footer>